"""
<%= name %> MCP Server
<%= description || 'Generated by create-mcp-server' %>
"""

import asyncio
from mcp.server import Server
<% if (transport === 'stdio') { %>
from mcp.server.stdio import stdio_server
<% } else { %>
from mcp.server.sse import SseServerTransport
<% } %>
from mcp.types import Tool, TextContent

# Create the server instance
server = Server("<%= name %>")


@server.list_tools()
async def list_tools() -> list[Tool]:
    """List available tools."""
    return [
<% if (includeExampleTool) { %>
        Tool(
            name="example_tool",
            description="An example tool that echoes the input",
            inputSchema={
                "type": "object",
                "properties": {
                    "query": {
                        "type": "string",
                        "description": "The query to echo",
                    },
                },
                "required": ["query"],
            },
        ),
<% } %>
<% tools.forEach(function(tool) { %>
        Tool(
            name="<%= tool.name %>",
            description="<%= tool.description %>",
            inputSchema={
                "type": "object",
                "properties": {
<% tool.parameters.forEach(function(param, index) { %>
                    "<%= param.name %>": {
                        "type": "<%= param.type %>",
                        "description": "<%= param.description %>",
                    }<%= index < tool.parameters.length - 1 ? ',' : '' %>
<% }); %>
                },
                "required": [<%= tool.parameters.filter(p => p.required).map(p => '"' + p.name + '"').join(', ') %>],
            },
        ),
<% }); %>
    ]


@server.call_tool()
async def call_tool(name: str, arguments: dict) -> list[TextContent]:
    """Handle tool calls."""
<% if (includeExampleTool) { %>
    if name == "example_tool":
        query = arguments.get("query", "")
        return [TextContent(type="text", text=f"Echo: {query}")]
<% } %>

<% tools.forEach(function(tool) { %>
    if name == "<%= tool.name %>":
        # TODO: Implement <%= tool.name %> logic
<% tool.parameters.forEach(function(param) { %>
        <%= param.name %> = arguments.get("<%= param.name %>")
<% }); %>
        return [TextContent(type="text", text=f"<%= tool.name %> called with: {arguments}")]
<% }); %>

    raise ValueError(f"Unknown tool: {name}")


async def main():
    """Main entry point."""
<% if (transport === 'stdio') { %>
    async with stdio_server() as (read_stream, write_stream):
        await server.run(
            read_stream,
            write_stream,
            server.create_initialization_options(),
        )
<% } else { %>
    # SSE transport implementation
    transport = SseServerTransport("/messages")
    await server.run(transport)
<% } %>


if __name__ == "__main__":
    asyncio.run(main())
